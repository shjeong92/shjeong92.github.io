<!DOCTYPE html>
<html lang="ko">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>RESTful API에 관하여 - Hyuk's devlog</title>

<meta name="description" content="본 포스트는 “그런 REST API로 괜찮은가”라는 이응준님의 발표를 보고 정리한 내용입니다.최근 여러 면접에서 RESTful API가 무엇이라고 생각하는가? 에 대한 질문은 어딜 가던지 물어보았습니다 구글링을 통해서 얻은 답을 했었는데 이게 다가 아닌것 같은 느낌.. 그러다가 지...">
<link rel="canonical" href="https://shjeong92.github.io/2021/07/12/REST.html">
<link rel="alternate" type="application/rss+xml" title="Hyuk's devlog" href="/feed.xml">
<!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
<link rel="manifest" href="/assets/site.webmanifest">
<link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50">
<link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d">
<meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css">
<!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root">
<div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner">
<div class="page__header d-print-none">
<header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand">
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewbox="0 0 24 24">
<style type="text/css">
	.st0{fill:#515151;}
</style>
<path class="st0" d="M1.7,22.3c5.7-5.7,11.3-5.7,17,0c3.3-3.3,3.5-5.3,0.8-6c2.7,0.7,3.5-1.1,2.3-5.6s-3.3-5.2-6.3-2.1
	c3-3,2.3-5.2-2.1-6.3S7,1.8,7.7,4.6C7,1.8,5,2.1,1.7,5.3C7.3,11,7.3,16.7,1.7,22.3"></path>
</svg>
<a title="Your Site Description
" href="/">Hyuk's devlog</a>
</div>
<button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button>
</div>
<nav class="navigation">
        <ul>
<li class="navigation__item"><a href="/archive.html">아카이브</a></li>
<li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li>
</ul>
      </nav>
</div>
  </header>
</div>
<div class="page__content"><div class="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto">
<!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>RESTful API에 관하여</h1></header></div>
<meta itemprop="headline" content="RESTful API에 관하여">
<div class="article__info clearfix">
<ul class="left-col menu">
<li>
              <a class="button button--secondary button--pill button--sm" href="/archive.html?tag=REST">REST</a>
            </li>
<li>
              <a class="button button--secondary button--pill button--sm" href="/archive.html?tag=RESTful">RESTful</a>
            </li>
<li>
              <a class="button button--secondary button--pill button--sm" href="/archive.html?tag=API">API</a>
            </li>
<li>
              <a class="button button--secondary button--pill button--sm" href="/archive.html?tag=HTTP">HTTP</a>
            </li>
<li>
              <a class="button button--secondary button--pill button--sm" href="/archive.html?tag=SOAP">SOAP</a>
            </li>
</ul>
<ul class="right-col menu"><li>
<i class="far fa-calendar-alt"></i> <span>2021년 07월 12일</span>
            </li></ul>
</div>
<meta itemprop="author" content="Sanghyuk Jeong">
<meta itemprop="datePublished" content="2021-07-12T00:00:00+09:00">
    <meta itemprop="keywords" content="REST,RESTful,API,HTTP,SOAP">
<div class="js-article-content">
<div class="layout--article">
<!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody">
<p>본 포스트는 <a href="https://www.youtube.com/watch?v=RP_f5dMoHFc">“그런 REST API로 괜찮은가”</a>라는 이응준님의 발표를 보고 정리한 내용입니다.</p>

<p>최근 여러 면접에서 RESTful API가 무엇이라고 생각하는가? 에 대한 질문은 어딜 가던지 물어보았습니다 
구글링을 통해서 얻은 답을 했었는데 이게 다가 아닌것 같은 느낌.. 그러다가 지인한테 RESTful API가 뭐라고생각하냐고 물으면 뭐라 답할것인가 물었더니 이 영상을 추천해 주시더군요 ㅎㅎㅎ RESTful API의 탄생배경부터 로이필딩에 관한 이야기까지 정말 재미있게 봤습니다.</p>

<h3 id="rest란">REST란</h3>

<p><strong>RE</strong>presentational</p>

<p><strong>S</strong>tate</p>

<p><strong>T</strong>ransfer</p>

<p>의 약자라고 하는데요, 이것만 봐선 도무지 뭔지 모르겠네요..</p>

<h3 id="rest의-출현-계기">REST의 출현 계기</h3>

<p>REST는 웹으로 부터 시작되었습니다. www가 팀 버너스 리에 의해 탄생 되었는데요. 하나의 고민이 있었죠</p>

<h4 id="팀-버너스리의-고민1991">팀 버너스리의 고민(1991)</h4>

<p><strong><em>어떻게 인터넷에서 정보를 공유할 것인가?</em></strong></p>

<ul>
  <li>
<strong>모든 정보들을 하이퍼 텍스트로 연결</strong>
    <ul>
      <li>표현방식: HTML</li>
      <li>식별자: URI</li>
      <li>전송 방법: HTTP</li>
    </ul>
  </li>
</ul>

<h4 id="http10-1994-1996">HTTP/1.0 (1994-1996)</h4>

<p><strong>로이필딩</strong>이 HTTP개발에 참여하였고</p>

<p><strong><em>어떻게 웹을 망가 뜨리지 않고 HTTP를 진보시킬까?</em></strong> 라는 고민을 하였는데요,</p>

<p>로이는 고민 끝에 HTTP Object Model이라는 것을 만들었습니다. 이는 4년 후 “Representational State Transfer: An Architectural Style for Distributed Hypermedia interaction”에서 REST를 최초로 공개 하였는데요. 이후 2년 후, “Architectural Styles and the Design of Network-based Software Architectures”을 박사 논문으로 발표하게 되었고, 이 박사 논문이 바로 그 REST라는 것을 정의한느 논문입니다.</p>

<h4 id="api1998">API(1998)</h4>
<p>그런 한편, API라는 것이 있는데요. 98년에 마이크로소프트에서 원격으로 다른 시스템에 메소드를 호출할 수 있는 XML-RPC( 1998) 프로토콜을 만들었습니다.</p>

<p>이는 곧 SOAP이라는 이름으로 바뀌고, <strong>Salesforce</strong>라는 회사가 인터넷에서 최초로 공개하게 되었는데 장사가 잘 되지 않았죠. 
당시 SOAP을 사용해서 api를 만들었는데 단순한 요청임에도 아래와 같이 상당히 복잡한 것을 알 수 있습니다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">&lt;</span>?xml version="1.0", encoding="utf-8"&gt;
<span class="nt">&lt;soapenv:Envelope</span> <span class="na">xmlns:soapenv=</span><span class="s">"http://schemas.xmlsoap.org/soap/envelope/"</span>
  <span class="na">xmlns:urn=</span><span class="s">"urn:enterprise.soap.sforce.com"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;soapenv:Header&gt;</span>
    <span class="nt">&lt;urn:SessionHeader&gt;</span>
      <span class="nt">&lt;urn:sessionId&gt;&lt;b&gt;</span>QwWsHJyTPW.1pd0_jXlNKOSU<span class="nt">&lt;/b&gt;&lt;/urn:sessionId&gt;</span>
    <span class="nt">&lt;/urn:SessionHeader&gt;</span>
  <span class="nt">&lt;/soapenv:Header&gt;</span>
  <span class="nt">&lt;soapenv:Body&gt;</span>
      <span class="nt">&lt;urn:fieldList&gt;&lt;b&gt;</span>Id, Name, Website<span class="nt">&lt;/b&gt;&lt;/urn:fieldList&gt;</span>
      <span class="nt">&lt;urn:sObjectType&gt;&lt;b&gt;</span>Account<span class="nt">&lt;/b&gt;&lt;/urn:sObjectType&gt;</span>
      <span class="c">&lt;!--Zero or more repetitions:--&gt;</span>
      <span class="nt">&lt;urn:ids&gt;&lt;b&gt;</span>001D000000HS2Su<span class="nt">&lt;/b&gt;&lt;/urn:ids&gt;</span>
      <span class="nt">&lt;urn:ids&gt;&lt;b&gt;</span>001D000000HRzKD<span class="nt">&lt;/b&gt;&lt;/urn:ids&gt;</span>
    <span class="nt">&lt;/urn:retrieve&gt;</span>
  <span class="nt">&lt;/soapenv:Body&gt;</span>
<span class="nt">&lt;/soapenv:Envelope&gt;</span>
</code></pre></div></div>

<p>너무 복잡하여 <strong>Salesforce</strong>의 api는 많이 쓰이지 않게 됩니다. 그리고 <strong>flickr</strong>에서 SOAP을 사용하여 API를 발표하는데 아래와 훨씬 간단해 졌습니다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;s:Envelope</span> <span class="na">xmlns:s=</span><span class="s">"http://www.w3.org/2001/06/soap-envelope&gt;"</span>
  <span class="err">&lt;s.Body</span><span class="nt">&gt;</span>
    <span class="nt">&lt;s.Fault&gt;</span>
      <span class="nt">&lt;faultcode&gt;</span>flickr.error.[error-code]<span class="nt">&lt;/faultcode&gt;</span>
      <span class="nt">&lt;faultstring&gt;</span>[error-message]<span class="nt">&lt;/faultstring&gt;</span>
      <span class="nt">&lt;faultactor&gt;</span>http://www.flickr.com/services/soap/<span class="nt">&lt;/faultactor&gt;</span>
      <span class="nt">&lt;details&gt;</span>Please see http://flickr.com/services/docs/ for more details<span class="nt">&lt;/details&gt;</span>
    <span class="nt">&lt;/s.Fault&gt;</span>
  <span class="nt">&lt;/s.Body&gt;</span>
<span class="nt">&lt;/s:Envelope&gt;</span>
</code></pre></div></div>

<p>그 이후 로이 필딩이 논문을 바탕으로 REST를 발표하는데</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;rsp</span> <span class="na">stat=</span><span class="s">"fail"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;err</span> <span class="na">code=</span><span class="s">"[error-code]"</span> <span class="na">msg=</span><span class="s">"[error-message]"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/rsp&gt;</span>
</code></pre></div></div>

<p>딱 보더라도 훨씬 짧고, SOAP에 비해서 단순하며 규칙도 적으며 쉽다고 느끼게 되었습니다.
많은 사람들이 SOAP에서 REST로 갈아타게 됩니다.</p>

<p><img src="https://user-images.githubusercontent.com/75003424/125241701-bdf2cb00-e326-11eb-9314-9e8085d2417d.png" alt="rest-graph"></p>

<p>또한, 2006년에 AWS가 자사 API의 사용량의 85%가 REST임을 밝혔고,</p>

<p>2010년에 Salesforce.com또한 REST API를 추가했습니다.</p>

<p>이렇게 WWW의 API가 REST로 정착이 되나 싶었지만…</p>

<h4 id="cmis2008">CMIS(2008)</h4>
<ul>
  <li>IBM, 마이크로소프트등의 기업들이 함께 작업했고, REST를 지원한다고 발표했으나</li>
  <li>REST를 만든 장본인 로이필딩은 <strong>“CMIS에는 REST가 없다”</strong> 라고 말을했죠</li>
</ul>

<h4 id="microsoft-rest-api-guidelines2016">Microsoft REST API Guidelines(2016)</h4>

<p>2016년에는 MS에서 API 가이드라인을 만들었는데요
uri는 https://{serviceRoot}/{collection}/{id} 형식이어야한다
GET, PUT, DELETE, POST, HEAD, PATCH, OPTIONS를 지원해야한다
API 버저닝은 Major.minor로 하고 uri에 버전 정보를 포함시킨다.</p>

<p>제가 개념으로 알고 있었던 REST API인.. 내막은 몰랐던것인데</p>

<p>로이 필딩은 여기다대고 <strong>“이것 또한 REST 아님!”</strong> 이라고 트위터에 적었고,
블로그에 <code class="language-plaintext highlighter-rouge">"REST APIs must be hypertext-driven"</code>이라고 적었으며, 
<code class="language-plaintext highlighter-rouge">"the best practice for versioning an API is: “Don’t”</code>을 덧 붙였죠.</p>

<p>사람들이(저를 포함) 알고 있던 REST API와 제작자인 로이의 REST API는 너무나도 다르네요!</p>

<p>무엇이 문제였고, 왜 이런 차이가 났는지 알아봅시다.</p>

<h3 id="rest-api란">REST API란?</h3>

<p>REST API -&gt; REST 아키텍처를 따르는 스타일 -&gt; <strong>제약 조건의 집합</strong></p>

<p>모든 조건을 따라야 REST API인것이죠</p>

<p>그래서 REST는 아키텍쳐 스타일면서 하이브리드 아키텍처 스타일이라고 말합니다.
아키텍처 스타일이면서, 동시에 아키텍처 스타일이 집합이기 때문입니다.</p>

<h4 id="rest를-구성하는-스타일">REST를 구성하는 스타일</h4>

<ol>
  <li>Client - Server</li>
  <li>Stateless</li>
  <li>Cache</li>
  <li>Layered System</li>
  <li>Code-on-Demand (optional)</li>
  <li><strong>Uniform Interface</strong></li>
</ol>

<p>대체로 REST라고 부르는 것들은 위의 조건을 대부분 지키고 있습니다. 왜냐하면 HTTP만 잘 따라도 Client-Server, Stateless, Cache, Layered System은 다 지킬 수 있기 때문인데, Code-on-Demand는 서버에서 코드를 클라이언트로 보내서 실행할 수 있어야 한다는 것을 의미, 즉 자바스크립트를 의미하며, 필수는 아닙니다.</p>

<p>하지만 로이가 REST가 아니라고 말하는 것들은 Uniform Interface를 만족하지 못하는 것이 대부분 입니다. Uniform Interface 역시 아키텍처 스타일이기 때문에 안에 뭐가 들어있는지 보도록 하겠습니다.</p>

<h4 id="uniform-interface의-제약조건">Uniform Interface의 제약조건</h4>

<ul>
  <li>Identification of resources</li>
  <li>Manipulation of resources through representations</li>
  <li><strong>Self-descriptive messages</strong></li>
  <li><strong>Hypermedia as the engine of application sate(HATEOAS)</strong></li>
</ul>

<p>dentification of resources은 URI로 리소스가 식별되면 된다는 것이고, Manipulation of resources through representations는 representation 전송을 통해서 리소스를 조작해야된댜는 것입니다. 즉, 리소스를 만들거나 삭제, 수정할 때 http 메시지에 그 표현을 전송해야된다는 것이죠. 위 2가지 조건은 대부분 잘 지켜지고 있습니다.</p>

<p>하지만 문제는 아래의 2가지 입니다. 이 두가지 조건 때문에 우리가 부르는 REST API는 REST API가 아니게 되는것 입니다.</p>

<h4 id="self-descriptive-messages">Self-descriptive messages</h4>

<p>메세지는 스스로를 설명해야함.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET / HTTP/1.1
</code></pre></div></div>

<p>단순히 루트를 얻어오는 GET 요청인데요, 이 HTTP 요청 메시지는 뭔가 빠져 있어서 Self-descriptive 하지 못합니다.</p>

<p>우선 목적지가 빠져있는데,</p>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">HTTp</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="n">www.example.org</span><span class="w">
</span></code></pre></div></div>

<p>이 요청이 www.example.org 라는 도메인으로 간다라는 목적지가 빠져있기 때문에 이런 경우는 Self-descriptive하지 않다고 합니다.</p>

<p>또한, 이런 것도 생각해볼 수 있습니다. 200 OK 응답 메시지이며, JSON 본문이 있습니다.</p>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"op"</span><span class="o">:</span><span class="w"> </span><span class="s2">"remove"</span><span class="p">,</span><span class="w"> </span><span class="s2">"path"</span><span class="o">:</span><span class="w"> </span><span class="s2">"/a/b/c"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>이렇게 되면 당연히 Self-descriptive 하지 않는데요, 그 이유는 이걸 클라이언트가 해석하려고 하면, 어떤 문법으로 작성된 것인지 모르기 때문에 해석에 실패합니다. 그렇기 때문에 Content-Type 헤더가 반드시 들어가야 합니다.</p>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">

</span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"op"</span><span class="o">:</span><span class="w"> </span><span class="s2">"remove"</span><span class="p">,</span><span class="w"> </span><span class="s2">"path"</span><span class="o">:</span><span class="w"> </span><span class="s2">"/a/b/c"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>자 컨텐츠 헤더가 추가되어서 이제 대괄호 중괄호 및 키와 값을 파싱할 수 있게 되었습니다.</p>

<p>하지만 아직까지도 Self-descriptive하다고 볼 수는 없습니다.
왜냐하면 op값과, path값이 무엇을 의미하는지 알 수 없기 때문입니다.</p>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">-</span><span class="n">patch</span><span class="o">+</span><span class="n">json</span><span class="w">

</span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"op"</span><span class="o">:</span><span class="w"> </span><span class="s2">"remove"</span><span class="p">,</span><span class="w"> </span><span class="s2">"path"</span><span class="o">:</span><span class="w"> </span><span class="s2">"/a/b/c"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>이렇게 명시를 하면 완전해진다. 이 응답은 json-patch+json이라는 미디어 타입으로 정의된 메시지이기 때문에 json-patch라는 명세를 찾아가서 이해한 다음, 이 메시지를 해석을 하면 그제서야 올바르게 메시지의 의미를 이해할 수 있게 됩니다.</p>

<p><strong>이처럼 Self-descriptive message라는 것은 메시지를 봤을 때 메시지의 내용으로 온전히 해석이 다 가능해야된다는 것입니다.</strong></p>

<p>하지만 오늘날의 REST API는 상당히 이를 만족하지 못하고 있습니다. 대부분 미디어 타입에는 그냥 json(제가 작성한것 앱 또한 마찬가지..)이라고만 되어있고 이를 어떻게 해석해야되는지는 명시가 되어있지 않습니다.</p>

<h4 id="hateoas">HATEOAS</h4>

<p><strong>애플리케이션의 상태는 Hyperlink를 이용해 전이되어야 함</strong></p>

<p><img src="https://user-images.githubusercontent.com/75003424/125241702-be8b6180-e326-11eb-8cfd-e20a313c0cb7.png" alt="HATEOAS"></p>

<p>위와 같은 사이트가 있다고 가정해봅시다.</p>

<p>루트 -&gt; 글목록보기(GET) -&gt; 글 쓰기(GET) -&gt; 글 저장(POST) -&gt; 생성된 글 보기(GET) -&gt; 목록 보기(GET)</p>

<p>이렇게 상태를 전이하는 것을 애플리케이션 상태 전이라고 하고, 이 상태 전이마다 항상 해당 페이지에 있던 링크를 따라가면서 전이했기 때문에 HATEOAS를 만족한다고 할 수 있습니다. 말 그대로, 하이퍼 링크를 통한 전이가 된다는 점이 이를 만족 한다는 것이죠.</p>

<p>HTML의 경우 HATEOAS를 만족하는데,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: text/html

&lt;html&gt;
&lt;head&gt; &lt;/head&gt;
&lt;body&gt; &lt;a href="/test"&gt; test &lt;/a&gt; &lt;/body&gt;
&lt;/html&gt;
</code></pre></div></div>
<p><strong>a태그</strong>를 통해서 그 다음 상태로 전이가 가능하기 떄문에 만족한다고 할 수 있습니다.</p>

<p>그렇다면 JSON으로는 어떻게 표현하면 될까요?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-Type: application/json
Link: &lt;/articles/1&gt;; rel="previous",
			&lt;/articles/3&gt;; rel="next";

{
	"title": "The second article",
	"contents": "blah blah..."
}
</code></pre></div></div>

<p><strong>Link라는 헤더가 있는데, 이것이 바로 이 리소스와 하이퍼링크로 연결되어 있는 다른 리소스를 가르킬 수 있는 기능을 제공해줍니다.</strong></p>

<p>여기서 어떤 1개의 페이지를 표현 했는데, 이전페이지를 /articles/1, 다음 페이지는 /articles/3에 있다는 정보를 표현해준 것이지요.</p>

<h4 id="uniform-interface가-중요한-이유">Uniform Interface가 중요한 이유</h4>

<h5 id="1-독립적-진화">1. 독립적 진화</h5>

<ul>
  <li>서버와 클라이언트가 각각 독립적으로 진화한다.</li>
  <li>서버의 기능이 변경되어도 클라이언트를 업데이트할 필요가 없다.</li>
  <li>REST를 만든 계기 : “How do I imporve HTTP without breaking the Web”</li>
</ul>

<p>독립적으로 진화한다면 어떻게 될까요?</p>

<p>만약에 서버의 기능이 바뀌었다면?.</p>

<p>새로운 API가 추가되고 기존 API가 변경/삭제되고 URI가 바뀌고 변동이 있어도, 클라이언트가 바뀌지 않아도 된다. (이점을 만족하는 애플리케이션이 거의 없음)</p>

<p>이게 바로 REST를 만들게 된 계기입니다. 로이 필딩이 초반에 http 1.0을 만들 당시 고민했던 것, “웹을 망가뜨리지 않고 어떻게 수정할 것인가?”에 대한 결과가 REST였다고 했다. ~<del>uri로 자원을 명시하고 어쩌고 저쩌고를 떠나서 말이죠</del></p>

<p>그렇기 때문에 REST가 목적하는 바가 독립적인 진화입니다. 이를 달성하기 위해서는 Unifrom Interface가 필수적이기기에, 이를 만족하지 못하면 REST라고 부를 수 없는 것입니다.</p>

<h4 id="아주-rest한-사례">아주 REST한 사례</h4>

<p>REST를 아주 잘 지키고 있는 사례는 바로 웹 입니다.</p>

<p>그 이유로는</p>

<ul>
  <li>웹 페이지를 변경했다고 웹 브라우저를 업데이트할 필요는 없습니다.</li>
  <li>웹 브라우저를 업데이트 했다고 웹 페이지를 변경할 필요도 없습니다.</li>
  <li>HTTP 명세가 변경되어도 웹은 잘 작동합니다.</li>
  <li>HTML 명세가 변경되어도 웹은 잘 작동합니다.</li>
</ul>

<p>우리가 들어가는 웹 페이지가 변경되었다고 해서 그 웹 페이지를 접근할 때 웹 브라우저를 업데이트 할 필요 없지요 그냥 잘 들어가집니다.</p>

<p>반대로 크롬을 업데이트 했다고 해서, 웹 페이지에 안들어가지는 것도 아닙니다.</p>

<p>심지어 HTTP 명세가 바뀌어도 그렇다. 2014년 HTTP 2.0이 나오고 여러가지 웹 페이지들이 HTTP 2.0을 적용한다. 하지만 적용을 하지 않은 사이트들도 여전히 잘 됩니다.</p>

<p>HTML 5.0이 HTML 5.2로 바뀌어도 똑같이 잘 됩니다.</p>

<p>오래된 버전의 브라우저 에서는 페이지가 좀 깨지기는 할 수 있지만 모든 기능이 동작 합니다.</p>

<p><strong>우리가 만든 모바일 앱은 많은 문제가 있습니다.</strong></p>

<p>아래와 같은 문제이지요
<img src="https://user-images.githubusercontent.com/75003424/125241703-be8b6180-e326-11eb-915c-6b982a9358e4.png" alt="prob"></p>

<p>이것은 무슨 이야기일까요? 앱이 강제 업데이트 하는 경우가 있는데, 서버가 기능이 변경되어 있을경우 클라이언트가 그것을 지원해주는데 한계가 있을 때 업데이트를 진행하는 것입니다. 그런데 이게 되게 잦다는 것이죠.</p>

<p>분명히 웹에서는 이런 경우가 잘 없습니다. 왜냐하면 무중단 배포가 가능하기 때문입니다.  하지만 모바일 앱에서는 자주 있는 일이에요. 제가 예전에 게임 어플리케이션을 앱스토어 및 구글 플레이스토어에 등록한 적이있는데 검수과정에서 reject되는 경우도 있었고 그냥 통과되는경우도 있었는데요, 이 기간이 생각보다 길기 떄문입니다.</p>

<p>다르게 말하자면 우리가 만든 모바일 앱 클라이언트와 서버가 REST 아키텍처 스타일을 따르고 있지 않다고 말할 수 있는거겠죠?</p>

<p>웹은 어떻게 이렇게 가능하게 했을까요? 많은 사람이 피땀흘려 노력을 했기에 가능했던 것입니다.</p>
<ul>
  <li>W3C Working group에서 html을 만들고</li>
  <li>IEFT Working groups에서 http를 만들고</li>
  <li>웹 서버/브라우저 개발자들이 많은 토론을 하며 노력을 했습니다.</li>
</ul>

<p>HTML5 첫 초안에서 권고안이 나오는데 무려 6년 
HTTP/1.1 명세 개정판 작업하는데 7년
HTTP/1.1에 새로운 기능이 추가 되었겠지 라고 생각 할 수 있지만 아닙니다. 새로운 기능은 하나도 없었고, 문서를 다듬기만 하는데 7년이 걸렸습니다. 절대로 하위 호환을 깨드리지 않기 위해 정말 깊은 토론의 결과였던 것입니다.</p>

<h4 id="상호운용성interoperability에-대한-집착">상호운용성(interoperability)에 대한 집착</h4>

<ul>
  <li>Referer → 오타지만 안 고침</li>
  <li>charset → 잘못 지은 이름이지만 안 고침</li>
  <li>HTTP 상태 코드 418(I’m a teapot) 포기</li>
  <li>HTTP/0.9 아직도 지원(크롬, 파이어폭스)</li>
</ul>

<p>25년전 Referer 오타를 냈습니다 r이 하나 빠졌죠. 하지만 이를 고치지 못했습니다. 이를 고치는 순간 웹이 깨지기 때문이었죠. 또 charset이란 이름은 잘못 지었습니다. 원래 encoding이라고 이름을 지어야하는 데 그때 encoding 개념이 부족하여, character set이랑 같은 줄 알고 지었다. 하지만 그대로 두었습니다. 이름을 고치면 상호 운용성이 깨지기 때문이죠</p>

<p>또한, http 상태 코드가 하나씩 추가되다가 418번을 추가할 때가 되었는데, 문제가 생겼습니다. 만우절 때 만들었던 이상한 spec의 HTCPCP 상태 코드가 있는데, 이것은 http가 아니라서 무시를 해도 됐었습니다. 하지만 수많은 node.js와 같은 서버들의 http 서버 구현체들이 http 상태 코드로 구현을 해버렸죠. 그래서 처음에는 http 의장이 프로젝트마다 돌아다니면서 418 지원을 제거해야된다는 이슈를 올렸는데 맹비난을 받고 포기했다고 합니다. 그래서 418은 http 상태코드에서 영구 결번으로 만들게 되었다고 하죠. 이미 그런 구현체가 존재하고, 잘못 구현체들과 상호 운용성을 지켜주기 위해(안그러면 웹이 깨지기때문에) 이러한 결정을 한것입니다.</p>

<p><strong>크롬</strong>에서는 HTTP 버전이 올라가면서 예전 버전을 빼려고 시도했지만 몇몇 프록시에서 오작동 하는 것이 발견되어서 HTTP/0.9를 유지하게 되었던 사례도 있습니다.</p>

<p>그래서 이렇게 많은 사람들이 상호 운용성에 대한 노력 덕분에 독립적으로 진화될 수 있었던 것입니다.</p>

<h4 id="7-rest가-웹의-독립적-진화에-도움을-주었을까요">7) REST가 웹의 독립적 진화에 도움을 주었을까요?</h4>

<p>네 맞습니다.</p>

<ul>
  <li>Host 헤더 추가</li>
  <li>길이 제한 다루는 방법 명시 (414 URI Too Long 등)</li>
  <li>URI에서 리소스의 정의가 추상적으로 변경: “문서의 위치” → “식별하고자 하는 무언가”</li>
  <li>HTTP/1.1 명세 최신판에서 REST에 대한 언급이 들어감 → representaion의 개념도 있음 → 로이 필더 : HTTP와 URI 명세 저자 중 1명 ㅋㅋㅋ 당연히 영향을 줄 수 박에 없겠죠?</li>
</ul>

<h5 id="rest-는-성공했을까요">REST 는 성공했을까요?</h5>

<ul>
  <li>REST는 웹의 독립적 진화를 위해 만들어짐.</li>
  <li>그리고 웹은 독립적으로 진화하고 있습니다 → 성공!</li>
</ul>

<h5 id="그런데-rest-api는">그런데 REST API는?</h5>

<ul>
  <li>REST API는 REST 아키텍처 스타일을 따라야 한다.</li>
  <li>하지만 오늘날 스스로 REST API라고 하는 API들의 대부분이 REST 아키텍처 스타일을 따르지 않는다.</li>
</ul>

<h5 id="rest-api도-제약-조건들을-다-지켜야-하는건가요">REST API도 제약 조건들을 다 지켜야 하는건가요?</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"An API that provides network-based access to resources via uniform interface of self-descriptive messages containing hypertext to indicate potential state transition might be part of an overall system that is a RESTful application. - Roy T. Fielding
</code></pre></div></div>
<p>REST API라고 하는 것은 하이퍼 텍스트를 포함한 self-descriptive 메시지의 uniform interface를 통해 리소스에 접근하는 API라고 강조는데요</p>

<p>제작자가 그렇다면 그런것이죠! ㅎㅎㅎ</p>

<h5 id="원격-api가-꼭-rest-api여야-하는걸까요">원격 API가 꼭 REST API여야 하는걸까요?</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"REST emphasizes evolvability sustain on uncontrollable system. If you think you have control over the system or aren't interested in evolvability, don't waste your time arguing about REST. - Roy T. Fielding
</code></pre></div></div>

<p>시스템 전체를 통제할 수 있다고 생각하거나, 진화에 관심이 없다면, REST에 대해 따지느라 시간을 허비하지 마라. - 로이 필딩</p>

<p><strong>시스템 전체를 통제할 수 있을경우</strong> → 회사에서 서버 개발자인데, 클라이언트 개발자를 통제 가능할 때 or 클라이언트, 서버를 다 만들 수 있을 때</p>

<p><strong>진화에 관심이 없을경우</strong>→ 매일 업데이트 해서 유저들에게 불만을 들어도 난 상관이 없음</p>

<p>하지만 우리는 시스템 전체를 통제할 수 없기도 하고, 개발자로서 진화에 관심을 두어야 하기에 REST를 따라야 합니다.</p>

<h5 id="그럼-이제-어떻게-해야할까요">그럼 이제 어떻게 해야할까요?</h5>

<ol>
  <li>REST API를 구현하고 REST API라고 부른다.</li>
  <li>REST API 구현을 포기하고 HTTP API라고 부른다.</li>
  <li><strong>REST API가 아니지만 REST API라고 부른다. (대부분 앱들의 현재 상태)</strong></li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"I am getting frustrated by the number of people calling any HTTP-base interface a REST API... Please try to adhere to them or choose some other buzzword for your API." - Roy T. Fielding
</code></pre></div></div>
<p>로이필딩이 화가났죠 ㅎㅎ 3번을 계속 이행하면 답글을 달러 올지도 모른다고하네요 요즘도 활발히 활동 중이라고합니다…</p>

<h4 id="rest하게-api를-구현하는-방법들">REST하게 API를 구현하는 방법들</h4>

<h5 id="왜-api는-rest가-잘-안될까요">왜 API는 REST가 잘 안될까요?</h5>
<p>우선 웹하고 비교했을때 웹은 왜 RESTful해지기가 힘든지 봅시다.
<img src="https://user-images.githubusercontent.com/75003424/125241705-bf23f800-e326-11eb-8ad6-81a67ec382a0.png" alt="restful-1"></p>

<p>커뮤니케이션이 좀 다르죠? HTTP API는 사람이 아닌 기계가 해석합니다. 그러다 보니 미디어 타입이 다르지요 Json이나 XML같이 기계가 의미를 이해할 수 있는 포맷을 쓰게 된다.</p>

<p>그렇다면 문제의 원인이 <strong>미디어 타입</strong>이라고 볼 수 있겠죠?</p>

<p><img src="https://user-images.githubusercontent.com/75003424/125241705-bf23f800-e326-11eb-8ad6-81a67ec382a0.png" alt="restful-2"></p>

<p><strong>self-descriptive</strong> 측면에서 보면 JSON은 불완전합니다. 하지만 문법은 정의되어 있습니다. 어떻게 파싱하고 array를 어떻게 해석해라 까지는 말이죠. 안에 들어갈 수 있는 key-value에 대한 의미는 아무것도 정의되어 있지 않습니다.</p>

<p>즉, 문법은 해석 가능하지만 의미를 해석하려면 별도로 문서(API 문서 등)가 필요합니다.</p>

<p>HTML과 JSON을 비교해보면</p>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="n">example.org</span><span class="w">

</span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="w">

</span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span><span class="w">
</span><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span><span class="w">
</span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="w"> 
</span><span class="o">&lt;</span><span class="n">a</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="s2">"https://todos/1"</span><span class="o">&gt;</span><span class="w"> </span><span class="n">회사</span><span class="w"> </span><span class="n">가기</span><span class="w"> </span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span><span class="w"> 
</span><span class="o">&lt;</span><span class="n">a</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="s2">"https://todos/2"</span><span class="o">&gt;</span><span class="w"> </span><span class="n">집에</span><span class="w"> </span><span class="n">가기</span><span class="w"> </span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span><span class="w"> 
</span><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span><span class="w">
</span><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>HTML → Self-descriptive
    <ol>
      <li>응답 메시지의 Content-Type을 보고 미디어 타입이 text/html 확인</li>
      <li>HTTP 명세에 미디어 타입은 IANA에 등록되어 있다고 함 → IANA에서 text/html 명세 찾음</li>
      <li>IANA에 따르면 text/html 명세는 http://www.w3.org/TR/html 이므로 링크를 찾아가 명세 해석</li>
      <li>명세에 모든 태그의 해석 방법이 있으므로 이를 해석, 사용자에게 보여줄 수 있음</li>
      <li><strong>Success!</strong></li>
    </ol>
  </li>
  <li>HTML → HATEOAS
    <ol>
      <li>a 태그를 이용해 표현된 링크를 통해 다음 상태로 전이될 수 있으므로 만족</li>
      <li><strong>Success!</strong></li>
    </ol>
  </li>
</ul>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="n">example.org</span><span class="w">

</span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">

</span><span class="p">[</span><span class="w">
	</span><span class="p">{</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"회사 가기"</span><span class="p">},</span><span class="w">
	</span><span class="p">{</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"집에 가기"</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>JSON → self-descriptive
    <ol>
      <li>응답 메시지의 Content-Type을 보고 미디어 타입이 application/json 확인</li>
      <li>HTTP 명세에 미디어 타입은 IANA에 등록되어 있다고 함 → IANA에서 application/json 명세 찾음</li>
      <li>IANA에 따르면 application/json 명세는 draft-ietf-jsonvis-rfc7159bis-04 이므로 링크를 찾아가 명세 해석</li>
      <li>명세에 JSON 문서 파싱 방법이 명시 → 성공적으로 파싱, 그러나 “id”가 무엇을 의미하고, “title”이 무엇을 의미하는지 알 방법 없음.</li>
      <li>FAIL</li>
    </ol>
  </li>
  <li>JSON → HATEOAS
    <ol>
      <li>다음 상태로 전이할 링크가 없음.</li>
      <li><strong>FAIL</strong></li>
    </ol>
  </li>
</ul>

<h5 id="2-그런데-self-descriptive-hateoas가-어떻게-독립적인-진화에-도움이-될까요">2. 그런데 self-descriptive, HATEOAS가 어떻게 독립적인 진화에 도움이 될까요?</h5>

<p><strong>self-descriptive → 확장 가능한 커뮤니케이션</strong></p>

<p>서버나 클라이언트가 변경되더라도 오고가는 메시지는 언제나 self-descriptive 하므로 언제나 해석이 가능합니다.</p>

<p><strong>HATEOAS → 애플리케이션 상태 전이의 late binding</strong></p>

<p>어디서 어디로 전이가 가능한지 미리 결정하지 않고 어떤 상태로 전이가 완료 되어야 그 다음 전이될 수 있는 상태 결정 ⇒ <strong>링크는 동적으로 변경될 수 있음</strong></p>

<h3 id="그럼-rest-api로-바꿔봅시다">그럼 REST API로 바꿔봅시다.</h3>

<h4 id="self-descriptive"><strong>Self-descriptive</strong></h4>

<ul>
  <li>
    <p><strong>Media type 정의</strong></p>

    <ul>
      <li>미디어 타입을 하나 정의</li>
      <li>미디어 타입 문서 작성 → “id”, “title”의 의미 정의</li>
      <li>IANA에 미디어 타입을 등록. 이때 만든 문서를 미디어 타입의 명세로 등록</li>
      <li>이제 이 메시지를 보는 사람은 명세를 찾아갈 수 있음 → 메세시지 의미   e .온전히 해석 가능</li>
      <li><strong>Success</strong></li>
    </ul>
  </li>
</ul>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="n">example.org</span><span class="w">

</span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">vnd.todos</span><span class="o">+</span><span class="n">json</span><span class="w">
</span><span class="o">~~~</span><span class="n">s</span><span class="w">
</span><span class="p">[</span><span class="w">
	</span><span class="p">{</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"회사 가기"</span><span class="p">},</span><span class="w">
	</span><span class="p">{</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"집에 가기"</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>
<p><strong>단점</strong></p>

<p>-&gt; 매번 media type을 정의해야함</p>

<hr>

<ul>
  <li>
    <p><strong>Profile 이용하기</strong></p>

    <p>a. “id”, “title” 의미 정의한 명세 작성</p>

    <p>b. Link 헤더에 profile relation으로 명세 링크</p>

    <p>c. 이제 메시지를 보는 사람은 명세를 찾아갈 수 있음 → 의미 해석 가능</p>

    <p>d. <strong>Success</strong></p>
  </li>
</ul>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="n">example.org</span><span class="w">

</span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">
</span><span class="n">Link</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span><span class="o">://</span><span class="n">exmaple.org</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">todos</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="n">rel</span><span class="o">=</span><span class="s2">"profile"</span><span class="w">

</span><span class="p">[</span><span class="w">
	</span><span class="p">{</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"회사 가기"</span><span class="p">},</span><span class="w">
	</span><span class="p">{</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"집에 가기"</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>
<p><strong>단점</strong></p>

<ul>
  <li>클라이언트가 Link 헤더(RFC5988)와 profile(RFC 6906)을 이해해야함.</li>
  <li>Content negotiation 불가</li>
</ul>

<hr>

<h4 id="hateoas-1"><strong>HATEOAS</strong></h4>

<ul>
  <li><strong>data에 다양한 방법으로 하이퍼링크 표현</strong></li>
</ul>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="n">example.org</span><span class="w">

</span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">
</span><span class="n">Link</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span><span class="o">://</span><span class="n">exmaple.org</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">todos</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="n">rel</span><span class="o">=</span><span class="s2">"profile"</span><span class="w">

</span><span class="p">[</span><span class="w">
	</span><span class="p">{</span><span class="w">
		</span><span class="s2">"link"</span><span class="o">:</span><span class="w"> </span><span class="s2">"https://exmplae.org/todos/1, 
		"</span><span class="n">title</span><span class="s2">": "</span><span class="n">회사</span><span class="w"> </span><span class="n">가기</span><span class="s2">"
	},
	{
		"</span><span class="n">link</span><span class="s2">": "</span><span class="n">https</span><span class="o">://</span><span class="n">exmplae.org</span><span class="o">/</span><span class="n">todos</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="w"> 
		</span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"회사 가기"</span><span class="w">
	</span><span class="p">},</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>또는</p>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="n">example.org</span><span class="w">

</span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">
</span><span class="n">Link</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span><span class="o">://</span><span class="n">exmaple.org</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">todos</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="n">rel</span><span class="o">=</span><span class="s2">"profile"</span><span class="w">

</span><span class="p">{</span><span class="w">
	</span><span class="s2">"links"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="s2">"todo"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">"https://example.org/todos/{id}"</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="s2">"data"</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
		</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
		</span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"회사 가기"</span><span class="w">
	</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
		</span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"집에 가기"</span><span class="w">
	</span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>단점</strong></p>
<ul>
  <li>단점 : 링크를 표현하는 방법을 직접 정의해야함</li>
</ul>

<hr>

<ul>
  <li><strong>data에 다양한 방법으로 하이퍼링크 표현</strong></li>
</ul>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="n">example.org</span><span class="w">

</span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="n">OK</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">vnd.api</span><span class="o">+</span><span class="n">json</span><span class="w">
</span><span class="n">Link</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">https</span><span class="o">://</span><span class="n">exmaple.org</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">todos</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="n">rel</span><span class="o">=</span><span class="s2">"profile"</span><span class="w">

</span><span class="p">{</span><span class="w">
	</span><span class="s2">"data"</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
		</span><span class="s2">"type"</span><span class="o">:</span><span class="w"> </span><span class="s2">"todo"</span><span class="p">,</span><span class="w">
		</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
		</span><span class="s2">"attributes"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"회사 가기"</span><span class="p">},</span><span class="w">
	</span><span class="s2">"links"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"self"</span><span class="o">:</span><span class="w"> </span><span class="s2">"https://example.org/todos/1"</span><span class="w">
	</span><span class="p">},{</span><span class="w">
		</span><span class="s2">"type"</span><span class="o">:</span><span class="w"> </span><span class="s2">"todo"</span><span class="p">,</span><span class="w">
		</span><span class="s2">"id"</span><span class="o">:</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> 
		</span><span class="s2">"attributes"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"집에 가기"</span><span class="p">},</span><span class="w">
	</span><span class="s2">"links"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"self"</span><span class="o">:</span><span class="w"> </span><span class="s2">"https://example.org/todos/2"</span><span class="w">
	</span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p><strong>단점</strong></p>
<ul>
  <li>기존의 API를 많이 고쳐야함. (침투적)</li>
</ul>

<hr>

<ul>
  <li><strong>HTTP 헤더로 → Link, Location 등</strong></li>
</ul>

<div class="language-s highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">POST</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="w"> </span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w">
</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="w">

</span><span class="p">{</span><span class="w">
		</span><span class="s2">"title"</span><span class="o">:</span><span class="w"> </span><span class="s2">"점심 약속"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">HTTP</span><span class="o">/</span><span class="m">1.1</span><span class="w"> </span><span class="m">204</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">Content</span><span class="w">
</span><span class="n">Location</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">todos</span><span class="o">/</span><span class="m">1</span><span class="w">
</span><span class="n">Link</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;/</span><span class="n">todos</span><span class="o">/&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">rel</span><span class="o">=</span><span class="s2">"collection"</span><span class="w">
</span></code></pre></div></div>

<p>HATEOAS를 만족하고자 할경우 <strong>data, 헤더 모두 사용하면 좋음</strong></p>

<h4 id="media-type-등록은-필수인가요">Media type 등록은 필수인가요?</h4>

<p><strong>NO!</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"A REST API should be entered with no prior knowledge beyond the initial URI (bookmark) and set of standardized media types that are appropriate for the intended audience(i.e., expected to be understood by any client that might user the API). — Roy. T. Fielding
</code></pre></div></div>

<p>의도한 저자가 이해할 수만 있다면 상관 없는데요.</p>

<p>예를 들면 사내에서만 쓰는 API고 이를 이해하고 있다면 굳이 등록하지 않아도 된다고 합니다.</p>

<h5 id="등록의-장점">등록의 장점</h5>

<ul>
  <li>사전에 알고 있지 않은 사람도 누구나 쉽게 사용할 수 있게 됨</li>
  <li>이름 충돌을 피할 수 있음</li>
  <li>등록이 별로 어렵지 않다(어려워 보이지만..)</li>
</ul>

<h3 id="마무리">마무리</h3>

<ul>
  <li>오늘날 대부분 “REST API”는 사실 REST를 따르고 있지 않음.</li>
  <li>REST의 제약 조건 중 특히 self-descriptive와 HATEOAS를 잘 만족하지 못함.</li>
  <li>REST 긴 시간에 걸쳐(수십년) 진화하는 웹 애플리케이션을 위한 것.</li>
  <li>REST를 따를 것인지는 API 설계하는 이들이 스스로 판단하여 결정.</li>
  <li>REST를 따르겠다면 Self-decriptive와 HATEOAS를 만족시켜야함.
    <ul>
      <li>Self-decriptiv는 custom media type, profile link relation으로 만족 가능.</li>
      <li>HATEOAS는 HTTP 헤더나 본문에 링크를 담아 만족 가능.</li>
    </ul>
  </li>
  <li>REST를 따르지 않겠다면, “REST를 만족하지 않는 REST API”를 뭐라고 부를지 결정할것
    <ul>
      <li>HTTP API라고 부를 수도 있고</li>
      <li>그냥 이대로 REST API라고 부를 수도 → 로이형이 싫어함(답글 달러 올수도있음! ㅋㅋㅋㅋ)</li>
    </ul>
  </li>
</ul>

<hr>

<p>긴 글 읽느라 고생하셨습니다.</p>

<p>이해가 힘들경우에 이응준님의 동영상 한편을 보시는걸 강력하게 추천 드립니다!</p>
</div>
<section class="article__sharing d-print-none"></section><div class="d-print-none">
<footer class="article__footer"><meta itemprop="dateModified" content="2021-07-12T00:00:00+09:00">
<!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__subscribe">
<div class="subscribe">
<i class="fas fa-rss"></i> <a type="application/rss+xml" href="/feed.xml">구독하기</a>
</div>
</div></footer>
<div class="article__section-navigator clearfix"><div class="previous">
<span>이전</span><a href="/2021/07/07/OS-02.html">[ #2 ] 운영체제 - 가상메모리</a>
</div></div>
</div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div>
<section class="page__comments d-print-none"><div id="disqus_thread"></div>
  <script>
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  var disqus_config = function () {
    this.page.url = 'https://shjeong92.github.io/2021/07/12/REST.html';
    this.page.identifier = 'anything';
  };
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://sanghyuk-devlog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div>
<div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main">
<div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sanghyuk Jeong">
<meta itemprop="url" content="/">
<div class="footer__author-links">
<div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><li title="이메일 보내기">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:shjeong920522@gmail.com" target="_blank">
        <i class="fas fa-envelope"></i>
      </a>
</li></ul>
</div>
</div>
    </div>
<div class="site-info mt-2">
      <div>© Hyuk's devlog 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> &amp; <a title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div>
</div>
    </div>
<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal">
<script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">검색</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text">
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        취소</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div>
</div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>
